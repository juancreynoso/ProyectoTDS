<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Codigo Assembler</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <header>
    <h1>Generación de Código Assembler</h1>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="01_analisis_lexico.html">Análisis Léxico</a></li>
        <li><a href="02_analisis_sintactico.html">Análisis Sintáctico</a></li>
        <li><a href="03_analisis_semantico.html">Análisis Semántico</a></li>
        <li><a href="04_codigo_intermedio.html">Generación de Código Intermedio</a></li>
        <li><a href="05_codigo_objeto.html">Generación de Código Objeto</a></li>
        <li><a href="06_optimizacion.html">Optimización</a></li>
      </ul>
    </nav>
  </header>
  <main>
  <h2>Descripción</h2> 
    <p> La etapa de <b>Generación de Código Objeto</b> tiene como objetivo producir el <b>código assembler</b> a partir de la lista de instrucciones en 
    <b>código de tres direcciones</b> generada en la etapa anterior. <br>
    <h3>Generacion de Offsets</h3> 
    Durante esta fase fue necesario asignar <b>offsets</b> tanto a variables locales como a temporales. Los offsets representan 
    la posición que cada identificador ocupará dentro de la <b>pila de ejecución</b>, permitiendo acceder correctamente a sus valores durante la ejecución del programa. </p>
    <h4>Por ejemplo</h4>
    <p>Asignacion de offsets a temporales:</p>
    <pre>
      case NODE_OP:
        switch(root->info->OP.name) {
            case OP_PLUS:
            case OP_SUB:
            case OP_MULT:
            case OP_DIV:
            case OP_REST:
            case OP_MINUS:
            case OP_GT:
            case OP_LT:
            case OP_EQUALS:
            case OP_AND:
            case OP_OR:
            case OP_NOT:
                root->info->OP.offset = new_var_offset();
                set_offsets(root->right);
                set_offsets(root->left);
                break;
            case OP_ASSIGN:
                set_offsets(root->right);
                set_offsets(root->left);
                break;
        }
      break;
    </pre>
    <br>
    <h3>Un ejemplo de traduccion de <b>codigo tres direcciones</b> a <b>codigo assembler</b></h3>
    <pre>
      PROGRAM
      FUNC loop 
      PARAM a
      L0
      t0 := a GT 0
      ifFalse t0 GOTO L1
      t1 := a SUB 1
      a := t1
      GOTO L0
      L1
      RET a
      FFUNC
      FUNC main 
      LOAD 5
      t2 := CALL loop
      x := t2
      RET x
      FFUNC
      END

    </pre>
    <p>En Assembler:</p>
    <pre>
      .data

      .text
      loop: 
          enter  $24, $0
          mov %rdi, -8(%rbp)
      .L0:
          mov -8(%rbp), %r10
          cmp $0, %r10
          mov $1, %r10
          mov $0, %r11
          cmovg %r10, %r11
          mov %r11, -24(%rbp)
          mov -24(%rbp), %rax
          cmp $0, %rax
          je .L1
          mov -8(%rbp), %r10
          sub $1, %r10
          mov %r10, -16(%rbp)
          mov -16(%rbp), %r10
          mov %r10, -8(%rbp)
          jmp .L0
      .L1:
          mov -8(%rbp), %rax
          leave
          ret
      .globl main
      main: 
          enter  $24, $0
          mov $5, %rdi
          call loop
          mov %rax, -8(%rbp)
          mov -8(%rbp), %r10
          mov %r10, -16(%rbp)
          mov -16(%rbp), %rax
          leave
          ret

    </pre>


    <h2>Decisiones de diseño</h2>
    <p>

      <ul>
          <li>
            Con el objetivo de reducir la complejidad del compilador, se estableció que las variables globales solo pueden ser inicializadas con valores constantes.
          </li>
          <li>
            Durante el diseño de la gramática del lenguaje se decidió permitir que las definiciones de variables y funciones puedan intercalarse entre sí. 
            Para generar las secciones <code>.text</code> y <code>.data</code> del código assembler, se utilizaron punteros a buffers separados que permitieron construir cada sección de forma independiente y luego concatenarlas en un único archivo de salida.
          </li>
      </ul>  
      <br>

      <b>setz usado en not????</b>
    </p>



    </main>

    <footer>
    <a href="index.html">← Volver al índice</a>
    </footer>
</body>
</html>     